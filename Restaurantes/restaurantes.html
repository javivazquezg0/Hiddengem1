<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurantes - HiddenGem6</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="/notifications.css">
    <link rel="stylesheet" href="../Nav-Bar/nav-bar.css">
    <link rel="icon" href="../img/Logo">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="../utils.js"></script>
</head>
<body>
    <!--Nav-var-->
    <div class="menu">
        <ion-icon name="menu-outline"></ion-icon>
        <ion-icon name="close-outline"></ion-icon>
    </div>
    <div class="barra-lateral">
        <div>
            <div class="nombre-pagina">
                <ion-icon id="cloud" name="fast-food-outline"></ion-icon>
                <span>Juarnachaz</span>
            </div>
        </div>
        <nav class="navegacion">
            <ul>
                <li>
                    <a id="inicio" href="/index.html">
                        <ion-icon name="home-outline"></ion-icon>
                        <span>Inicio</span>
                    </a>
                </li>
                <li>
                    <a id="login" href="/Login/Login.html">
                        <ion-icon name="log-in-outline"></ion-icon>
                        <span>Inicia sesi&oacute;n</span>
                    </a>
                </li>
                <li>
                    <a href="../Registro/registrar-negocio.html">
                        <ion-icon name="pin-outline"></ion-icon>
                        <span>¬°Registra tu negocio!</span>
                    </a>
                </li>
                <li>
                    <a href="../Restaurantes/restaurantes.html">
                        <ion-icon name="star-half-outline"></ion-icon>
                        <span>Restaurantes</span>
                    </a>
                </li>
                <li>
                    <a href="../Dashboard/dashboard.html">
                        <ion-icon name="desktop-outline"></ion-icon>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <ion-icon name="storefront-outline"></ion-icon>
                        <span>Puestos</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <ion-icon name="rocket-outline"></ion-icon>
                        <span>¬øquienes somos?</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="cerrar-sesion">
                        <ion-icon name="log-out-outline"></ion-icon>
                        <span>Cerrar sesi√≥n</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div>
            <div class="linea"></div>
            <div class="modo-oscuro">
                <div class="info">
                    <ion-icon name="moon-outline"></ion-icon>
                    <span>darkmode</span>
                </div>
                <div class="switch">
                    <div class="base">
                        <div class="circulo">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--End Nav-Bar-->
    <div class="page-header">
        <h1>Descubre los mejores restaurantes</h1>
    </div>

    <div class="restaurants-container">
        <div class="filters-bar">
            <div class="search-bar">
                <input type="text" id="search-restaurant" placeholder="Buscar restaurante...">
                <button id="search-button"><i class="fas fa-search"></i></button>
            </div>
            <div class="filter-options">
                <select id="filter-category">
                    <option value="">Todas las categor√≠as</option>
                    <!-- Las categor√≠as se cargar√°n din√°micamente -->
                </select>
                <select id="filter-rating">
                    <option value="">Todas las calificaciones</option>
                    <option value="4">4+ estrellas</option>
                    <option value="3">3+ estrellas</option>
                    <option value="2">2+ estrellas</option>
                </select>
            </div>
        </div>

        <!-- Este div contendr√° las tarjetas generadas din√°micamente -->
        <div class="card-container" id="card-container">
            <!-- Inicialmente mostramos un indicador de carga -->
            <div class="loading-container">
                <div class="loading-spinner"></div>
            </div>
        </div>

        <div class="pagination" id="pagination">
            <!-- Los botones de paginaci√≥n se generar√°n din√°micamente -->
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-section">
                <h3>Acerca de Juarnachaz</h3>
                <p>Descubre los tesoros culinarios en tu ciudad. Desde restaurantes locales hasta experiencias gastron√≥micas √∫nicas, te ayudamos a encontrar lo mejor que tu comunidad tiene para ofrecer.</p>
            </div>
            <div class="footer-section">
                <h3>Enlaces r√°pidos</h3>
                <ul class="footer-links">
                    <li><a href="/index.html"><ion-icon name="home-outline"></ion-icon> Inicio</a></li>
                    <li><a href="../Restaurantes/restaurantes.html"><ion-icon name="star-half-outline"></ion-icon> Restaurantes</a></li>
                    <li><a href="../Registro/registrar-negocio.html"><ion-icon name="pin-outline"></ion-icon> Registra tu negocio</a></li>
                    <li><a href="../Dashboard/dashboard.html"><ion-icon name="desktop-outline"></ion-icon> Dashboard</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contacto</h3>
                <p><ion-icon name="mail-outline"></ion-icon> info@juarnachaz.com</p>
                <p><ion-icon name="call-outline"></ion-icon> (123) 456-7890</p>
                <div class="social-icons">
                    <a href="#" aria-label="Facebook"><ion-icon name="logo-facebook"></ion-icon></a>
                    <a href="#" aria-label="Twitter"><ion-icon name="logo-twitter"></ion-icon></a>
                    <a href="#" aria-label="Instagram"><ion-icon name="logo-instagram"></ion-icon></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Juarnachaz. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script>
// Las variables globales y los elementos DOM se declaran al inicio
const searchInput = document.getElementById('search-restaurant');
const searchButton = document.getElementById('search-button');
const filterCategory = document.getElementById('filter-category');
const filterRating = document.getElementById('filter-rating');

// Variables globales (solo una vez)
let currentPage = 1;
let itemsPerPage = 9;
let allBusinesses = [];
let filteredBusinesses = [];
let searchTimeout;

// Inicializaci√≥n al cargar el documento (solo una vez)
document.addEventListener('DOMContentLoaded', function() {
    console.clear();
    console.log("üöÄ Inicializando p√°gina de restaurantes...");
    
    // Verificar los elementos DOM cr√≠ticos
    if (!searchInput) console.warn("‚ö†Ô∏è Elemento #search-restaurant no encontrado");
    if (!filterCategory) console.warn("‚ö†Ô∏è Elemento #filter-category no encontrado");
    if (!filterRating) console.warn("‚ö†Ô∏è Elemento #filter-rating no encontrado");
    
    // Cargar datos iniciales y verificar usuario
    checkUserLogin();
    loadBusinesses();
    
    // Configurar event listeners para filtrado
    setupFilterListeners();
    
    // Agregar logging adicional
    console.log("üîç Elementos DOM encontrados:", {
        searchInput: !!searchInput,
        searchButton: !!searchButton,
        filterCategory: !!filterCategory,
        filterRating: !!filterRating
    });
});

// Funci√≥n para verificar si el usuario est√° logueado
function checkUserLogin() {
    console.log("Verificando estado de login...");
    const token = localStorage.getItem('token');
    const loginLink = document.querySelector('a[href="/Login/Login.html"]');
    const cerrarSesionLink = document.getElementById('cerrar-sesion');
    
    if (token) {
        console.log("Usuario logueado encontrado");
        if (loginLink) loginLink.style.display = 'none';
        if (cerrarSesionLink) cerrarSesionLink.style.display = 'block';
    } else {
        console.log("Usuario no logueado");
        if (loginLink) loginLink.style.display = 'block';
        if (cerrarSesionLink) cerrarSesionLink.style.display = 'none';
    }
}

// Configuraci√≥n de event listeners para filtrado
function setupFilterListeners() {
    console.log("Configurando event listeners...");
    
    if (searchInput) {
        // Limpiar event listeners existentes 
        searchInput.removeEventListener('input', handleSearchInput);
        
        // A√±adir nuevo listener para input con debounce
        searchInput.addEventListener('input', handleSearchInput);
        
        // A√±adir listener para Enter
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                clearTimeout(searchTimeout);
                applyFiltersWithAPI();
            }
        });
        
        console.log("‚úÖ Event listeners configurados para searchInput");
    }

    if (searchButton) {
        // Limpiar listener existente
        searchButton.replaceWith(searchButton.cloneNode(true));
        // Re-obtener el bot√≥n despu√©s de clonarlo
        const newSearchButton = document.getElementById('search-button');
        
        // Usar la API al hacer clic en el bot√≥n de b√∫squeda
        if (newSearchButton) {
            newSearchButton.addEventListener('click', function() {
                clearTimeout(searchTimeout);
                applyFiltersWithAPI();
            });
            console.log("‚úÖ Event listener configurado para searchButton");
        }
    }

    if (filterCategory) {
        // Usar la API al cambiar la categor√≠a
        filterCategory.addEventListener('change', applyFiltersWithAPI);
        console.log("‚úÖ Event listener configurado para filterCategory");
    }

    if (filterRating) {
        // Usar la API al cambiar la calificaci√≥n
        filterRating.addEventListener('change', applyFiltersWithAPI);
        console.log("‚úÖ Event listener configurado para filterRating");
    }
}

// Funci√≥n manejadora para el evento input con debounce
function handleSearchInput() {
    console.log("üìù Texto ingresado:", this.value);
    
    // Cancelar cualquier timeout anterior
    clearTimeout(searchTimeout);
    
    // Aplicar filtros despu√©s de 500ms sin escribir
    searchTimeout = setTimeout(() => {
        applyFiltersWithAPI();
    }, 500);
}

// Funci√≥n para aplicar filtros usando la API
async function applyFiltersWithAPI() {
    try {
        const cardContainer = document.getElementById('card-container');
        
        // Mostrar indicador de carga
        if (cardContainer) {
            cardContainer.innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                </div>
            `;
        }
        
        // Obtener valores de los filtros
        const searchTerm = searchInput ? searchInput.value.trim() : '';
        const categoryFilter = filterCategory ? filterCategory.value : '';
        const ratingFilter = filterRating ? filterRating.value : '';
        
        console.log("üîç Filtrando con API:", { searchTerm, categoryFilter, ratingFilter });
        
        // Construir URL con par√°metros de consulta
        let url = 'http://localhost:3001/api/negocios/filtro?';
        
        if (searchTerm) url += `q=${encodeURIComponent(searchTerm)}&`;
        if (categoryFilter) url += `categoria=${encodeURIComponent(categoryFilter)}&`;
        if (ratingFilter) url += `calificacion=${encodeURIComponent(ratingFilter)}&`;
        
        // Eliminar el √∫ltimo '&' si existe
        url = url.endsWith('&') ? url.slice(0, -1) : url;
        
        console.log("URL de la API:", url);
        
        // Hacer petici√≥n a la API
        const response = await fetch(url);
        console.log("Respuesta recibida:", response.status, response.statusText);
        
        if (!response.ok) {
            throw new Error(`Error HTTP: ${response.status}`);
        }
        
        // Guardar los resultados filtrados
        const data = await response.json();
        console.log("Datos recibidos:", data);
        
        filteredBusinesses = data;
        console.log("üßÆ Negocios filtrados recibidos:", filteredBusinesses.length);
        
        // Resetear a la primera p√°gina
        currentPage = 1;
        
        // Mostrar negocios filtrados
        displayBusinesses();
        
    } catch (error) {
        console.error("‚ùå Error al filtrar con API:", error);
        
        // En caso de error, intentar usar datos locales como fallback
        if (allBusinesses && allBusinesses.length > 0) {
            console.log("‚ö†Ô∏è Usando filtrado local como fallback");
            applyFiltersLocally();
        } else {
            // Mostrar mensaje de error
            const cardContainer = document.getElementById('card-container');
            if (cardContainer) {
                cardContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #dc3545; margin-bottom: 1rem;"></i>
                        <h3>Error al cargar datos</h3>
                        <p>No se pudieron filtrar los restaurantes. Int√©ntalo de nuevo m√°s tarde.</p>
                    </div>
                `;
            }
        }
    }
}

// Funci√≥n para filtrado local (fallback)
function applyFiltersLocally() {
    // Obtener valores de los filtros
    const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
    const categoryFilter = filterCategory ? filterCategory.value : '';
    const ratingFilter = filterRating ? parseFloat(filterRating.value) : 0;
    
    console.log("üîç Aplicando filtros localmente:", { 
        searchTerm, 
        categoryFilter, 
        ratingFilter
    });
    
    // Asegurarse de que allBusinesses exista y tenga datos
    if (!allBusinesses || allBusinesses.length === 0) {
        console.warn("‚ö†Ô∏è No hay datos de negocios para filtrar");
        return;
    }
    
    // Filtrar negocios localmente
    filteredBusinesses = allBusinesses.filter(business => {
        // Verificar que el negocio tenga datos v√°lidos
        if (!business) return false;
        
        // Filtro por texto de b√∫squeda
        let matchesSearch = true;
        
        if (searchTerm !== '') {
            // Crear un array con todos los campos relevantes para buscar
            const fieldsToSearch = [
                business.nombre || '',
                business.descripcion || '',
                business.categoria || '',
                business.calle || '',
                business.colonia || '',
                business.municipio || '',
                business.estado || ''
            ];
            
            // Verificar si alg√∫n campo contiene el t√©rmino de b√∫squeda
            matchesSearch = fieldsToSearch.some(field => 
                field.toLowerCase().includes(searchTerm)
            );
        }
        
        // Filtro por categor√≠a
        const matchesCategory = categoryFilter === '' || 
            (business.categoria && business.categoria === categoryFilter);
        
        // Filtro por calificaci√≥n
        const rating = business.promedio_calificaciones ? 
            (typeof business.promedio_calificaciones === 'number' ? 
                business.promedio_calificaciones : 
                parseFloat(business.promedio_calificaciones) || 0) : 0;
        
        const matchesRating = ratingFilter === 0 || rating >= ratingFilter;
        
        // Debe cumplir todos los filtros activos
        return matchesSearch && matchesCategory && matchesRating;
    });
    
    console.log("üßÆ Negocios filtrados localmente:", filteredBusinesses.length);
    
    // Resetear a la primera p√°gina
    currentPage = 1;
    
    // Mostrar negocios filtrados
    displayBusinesses();
}

// Cargar los negocios iniciales
async function loadBusinesses() {
    try {
        const cardContainer = document.getElementById('card-container');
        
        // Mostrar loading
        if (cardContainer) {
            cardContainer.innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                </div>
            `;
        }
        
        console.log("Intentando cargar datos del servidor...");

        // Intentar hacer una solicitud a la API
        try {
            // A√±adir timestamp para evitar cach√©
            const timestamp = new Date().getTime();
            const response = await Utils.fetchWithRetry(`http://localhost:3001/api/negocios/publicos?t=${timestamp}`);
            console.log("Respuesta del servidor:", response.status, response.statusText);
            
            if (!response.ok) {
                console.warn("La respuesta del servidor no fue OK, usando datos de muestra");
                throw new Error(`Error HTTP: ${response.status}`);
            }
            
            const data = await response.json();
            console.log("Datos recibidos:", data);
            
            if (!data || !Array.isArray(data) || data.length === 0) {
                console.warn("No hay datos en la respuesta, usando datos de muestra");
                throw new Error("No hay datos");
            }
            
            // Guardar y mostrar datos
            allBusinesses = data;
            filteredBusinesses = [...allBusinesses];
            
            loadCategories();
            displayBusinesses();
        } catch (apiError) {
            console.error("Error en solicitud a API:", apiError);
            console.log("Cargando datos de muestra como fallback");
            loadSampleBusinesses();
        }
    } catch (error) {
        console.error("Error general en loadBusinesses:", error);
        loadSampleBusinesses();
    }
}

// Cargar datos de ejemplo para desarrollo
function loadSampleBusinesses() {
    console.log('üìã Cargando datos de muestra');
    
    allBusinesses = [
        {
            id_Negocios: 1,
            nombre: "Pizzeria la Yemi",
            descripcion: "Las mejores pizzas de la ciudad",
            categoria: "Pizza",
            calle: "Av. Constituci√≥n",
            numero_exterior: "123",
            colonia: "Centro",
            municipio: "Ciudad",
            estado: "Estado",
            foto_portada: "../img/PIZZA.jpg",
            promedio_calificaciones: 4.5,
            total_resenas: 28,
            horario_cierre: "22:30"
        },
        {
            id_Negocios: 2,
            nombre: "Taqueria Javi",
            descripcion: "Tacos tradicionales",
            categoria: "Tacos",
            calle: "Calle Ju√°rez",
            numero_exterior: "456",
            colonia: "Reforma",
            municipio: "Ciudad",
            estado: "Estado",
            foto_portada: "../img/TACOS.jpg",
            promedio_calificaciones: 4.2,
            total_resenas: 45,
            horario_cierre: "22:00"
        },
        {
            id_Negocios: 3,
            nombre: "Caf√© Nuevo",
            descripcion: "Caf√© de especialidad",
            categoria: "Caf√©",
            calle: "Av. Reforma",
            numero_exterior: "789",
            colonia: "Del Valle",
            municipio: "Ciudad",
            estado: "Estado",
            foto_portada: "../img/cafe.jpg",
            promedio_calificaciones: 4.7,
            total_resenas: 36,
            horario_cierre: "22:00"
        },
        {
            id_Negocios: 4,
            nombre: "El Pozolero",
            descripcion: "Pozole tradicional mexicano",
            categoria: "Pozole",
            calle: "Calle Hidalgo",
            numero_exterior: "321",
            colonia: "Centro",
            municipio: "Ciudad",
            estado: "Estado",
            foto_portada: "../img/posole.jpg",
            promedio_calificaciones: 4.0,
            total_resenas: 22,
            horario_cierre: "20:00"
        }
    ];
    
    filteredBusinesses = [...allBusinesses];
    console.log("Datos de muestra cargados:", allBusinesses.length, "negocios");
    
    // Cargar categor√≠as y mostrar negocios
    loadCategories();
    displayBusinesses();
}   

// Cargar categor√≠as √∫nicas para el filtro
function loadCategories() {
    if (!filterCategory) return;
    
    // Obtener categor√≠as √∫nicas
    const categories = [...new Set(allBusinesses
        .filter(business => business.categoria) 
        .map(business => business.categoria))];
    
    console.log("üè∑Ô∏è Categor√≠as encontradas:", categories);
    
    // Crear opciones del select
    let categoryOptions = '<option value="">Todas las categor√≠as</option>';
    
    categories.forEach(category => {
        categoryOptions += `<option value="${category}">${category}</option>`;
    });
    
    // Agregar opciones al select
    filterCategory.innerHTML = categoryOptions;
}

// Funci√≥n para mostrar los negocios
function displayBusinesses() {
    const cardContainer = document.getElementById('card-container');
    const paginationContainer = document.getElementById('pagination');
    
    if (!cardContainer) {
        console.error("‚ùå Elemento #card-container no encontrado");
        return;
    }
    
    if (!paginationContainer) {
        console.warn("‚ö†Ô∏è Elemento #pagination no encontrado");
    }
    
    console.log("üìä Mostrando negocios:", {
        totalFiltrados: filteredBusinesses.length,
        paginaActual: currentPage,
        negociosPorPagina: itemsPerPage
    });
    
    // Calcular √≠ndices para la p√°gina actual
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    
    // Obtener los negocios para la p√°gina actual
    const businessesForCurrentPage = filteredBusinesses.slice(startIndex, endIndex);
    
    console.log("üìÑ Negocios en p√°gina actual:", businessesForCurrentPage.length);
    
    // Verificar si hay negocios para mostrar
    if (businessesForCurrentPage.length === 0) {
        cardContainer.innerHTML = `
            <div class="no-results">
                <i class="fas fa-search" style="font-size: 3rem; color: #ddd; margin-bottom: 1rem;"></i>
                <h3>No se encontraron negocios</h3>
                <p>Intenta con otra b√∫squeda o filtro</p>
            </div>
        `;
        if (paginationContainer) paginationContainer.innerHTML = '';
        return;
    }
    
    // Generar HTML para las tarjetas
    let cardsHTML = '';
    
    businessesForCurrentPage.forEach(business => {
        // Verificar que el negocio tenga datos v√°lidos
        if (!business) return;
        
        // Generar direcci√≥n completa
        const direccion = business.direccion || 
            `${business.calle || ''} ${business.numero_exterior || ''}, ${business.colonia || ''}`;
        
        // Manejo m√°s robusto de la imagen
        let imagenSrc = business.foto_portada || business.imagen;
        if (!imagenSrc || imagenSrc === '') {
            imagenSrc = '../img/default-restaurant.jpg';
        } else if (!imagenSrc.startsWith('http') && !imagenSrc.startsWith('/') && !imagenSrc.startsWith('./') && !imagenSrc.startsWith('../')) {
            imagenSrc = '../img/' + imagenSrc;
        }
        
        // Verificar si la calificaci√≥n est√° definida
        const rating = business.promedio_calificaciones ? 
            (typeof business.promedio_calificaciones === 'number' ? 
                business.promedio_calificaciones : 
                parseFloat(business.promedio_calificaciones) || 0) : 0;
        
        cardsHTML += `
            <div class="card" onclick="goToBusinessDetail(${business.id_Negocios})">
                <img src="${imagenSrc}" alt="${business.nombre}" onerror="this.src='../img/default-restaurant.jpg'">
                <div class="card-body">
                    <h3 class="card-title">${business.nombre || 'Restaurante'}</h3>
                    <div class="card-stars">${generateStars(rating)}</div>
                    <div class="card-details">
                        <i class="fas fa-utensils"></i> ${business.categoria || 'Restaurante'}
                    </div>
                    <div class="card-details">
                        <i class="fas fa-map-marker-alt"></i> ${direccion}
                    </div>
                    <span class="category-tag">${business.categoria || 'Restaurante'}</span>
                    <p class="open-status"><i class="fas fa-clock"></i> Abierto hasta las ${business.horario_cierre || '21:00'}</p>
                </div>
            </div>
        `;
    });
    
    // Actualizar el contenido del contenedor de tarjetas
    cardContainer.innerHTML = cardsHTML;
    
    // Generar paginaci√≥n
    generatePagination();
}

// Generar la paginaci√≥n
function generatePagination() {
    const paginationContainer = document.getElementById('pagination');
    
    if (!paginationContainer) return;
    
    const totalPages = Math.ceil(filteredBusinesses.length / itemsPerPage);
    
    if (totalPages <= 1) {
        paginationContainer.innerHTML = '';
        return;
    }
    
    let paginationHTML = `
        <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
            <i class="fas fa-chevron-left"></i>
        </button>
    `;
    
    for (let i = 1; i <= totalPages; i++) {
        paginationHTML += `
            <button class="${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                ${i}
            </button>
        `;
    }
    
    paginationHTML += `
        <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
            <i class="fas fa-chevron-right"></i>
        </button>
    `;
    
    paginationContainer.innerHTML = paginationHTML;
}

// Cambiar de p√°gina
function changePage(page) {
    const totalPages = Math.ceil(filteredBusinesses.length / itemsPerPage);
    
    if (page < 1 || page > totalPages) {
        return;
    }
    
    currentPage = page;
    displayBusinesses();
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Funci√≥n para ir al detalle del negocio
function goToBusinessDetail(businessId) {
    window.location.href = `detalle-negocio.html?id=${businessId}`;
}

// Generar estrellas basadas en la calificaci√≥n
function generateStars(rating) {
    // Asegurar que rating sea un n√∫mero
    rating = parseFloat(rating) || 0;
    
    // Limitar rating entre 0 y 5
    rating = Math.max(0, Math.min(5, rating));
    
    const fullStars = Math.floor(rating);
    const hasHalfStar = rating % 1 >= 0.5;

    let starsHTML = '';

    for (let i = 0; i < fullStars; i++) {
        starsHTML += '<i class="fas fa-star"></i>';
    }

    if (hasHalfStar) {
        starsHTML += '<i class="fas fa-star-half-alt"></i>';
    }

    const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
    for (let i = 0; i < emptyStars; i++) {
        starsHTML += '<i class="far fa-star"></i>';
    }

    return starsHTML;
}
</script>
<script type="module" src="/Nav-Bar/nav-bar.js"></script>
<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</body>
</html>